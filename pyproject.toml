[build-system]
requires = ["uv_build>=0.9.8,<0.10.0"]
build-backend = "uv_build"

[project]
name = "hassette"
version = "0.21.0"
description = "Hassette is a simple, modern, async-first Python framework for building Home Assistant automations."
readme = "README.md"
authors = [{ name = "Jessica", email = "12jessicasmith34@gmail.com" }]
license = "MIT"
requires-python = ">=3.11,<3.14"
keywords = [
    "home-assistant",
    "automation",
    "async",
    "typed",
    "framework",
    "smart-home",
    "iot",
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Home Automation",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Framework :: AsyncIO",
    "Typing :: Typed",
]
dependencies = [
    "aiohttp>=3.11.18",
    "anyio>=4.10.0",
    "coloredlogs>=15.0.1",
    "fastapi>=0.128.6",
    "jinja2>=3.1.0",
    "croniter>=6.0.0",
    "deepdiff>=8.6.1",
    "diskcache>=5.6.3",
    "fair-async-rlock>=1.0.7",
    "frozendict>=2.4.7",
    "glom>=24.11.0",
    "humanize>=4.13.0",
    "orjson>=3.10.18",
    "packaging>=25.0",
    "platformdirs>=4.3.8",
    "pydantic-settings>=2.10.0",
    "python-dotenv>=1.1.0",
    "tenacity>=9.1.2",
    "typing-extensions==4.15.*",
    "uvicorn[standard]>=0.34.0",
    "watchfiles>=1.1.0",
    "whenever==0.9.*",
]

[project.urls]
Homepage = "https://github.com/nodejsmith/hassette"
Repository = "https://github.com/nodejsmith/hassette"
Documentation = "https://github.com/nodejsmith/hassette#readme"
"Bug Reports" = "https://github.com/nodejsmith/hassette/issues"
Changelog = "https://github.com/nodejsmith/hassette/blob/main/CHANGELOG.md"


[dependency-groups]
dev = [
    "coverage[toml]>=7.10.7",
    "djlint>=1.36.4",
    "httpx>=0.28.0",
    "playwright>=1.52.0",
    "pyright>=1.1.408",
    "pytest>=8.4.0",
    "pytest-cov>=7.0.0",
    "pytest-playwright>=0.6.2",
    "tomli-w>=1.2.0",
]
test = [
    "nox>=2025.5.1",
    "pytest>=8.4.0",
    "pytest-asyncio>=1.0.0",
    "pytest-randomly>=3.16.0",
    "pytest-xdist>=3.8.0",
]
model_gen = ["datamodel-code-generator>=0.30.1"]
docs = [
    "mkdocs>=1.6.0",
    "mkdocs-gen-files>=0.5.0",
    "mkdocs-literate-nav>=0.6.1",
    "mkdocs-material>=9.6.0",
    "mkdocs-autorefs>=0.5.0",
    "mkdocstrings[python]>=0.25.0",
    "pymdown-extensions>=10.8.1",
    "watchdog>=6.0.0",
    "ruff>=0.14.9",
]

[tool.uv]
default-groups = ["dev", "test", "docs"]

[project.scripts]
hassette = "hassette.__main__:entrypoint"

[tool.uv.build-backend]
module-name = "hassette"

[tool.pytest.ini_options]
pythonpath = "src"
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "session"
asyncio_default_test_loop_scope = "session"
filterwarnings = ["error"]
# Skip slow Docker tests by default (run with: pytest -m docker)
addopts = "-m 'not docker and not e2e'"
markers = [
    "integration: marks tests as integration tests (deselect with '-m \"not integration\"')",
    "docker: marks tests that require Docker and are slow (run explicitly with '-m docker')",
    "e2e: marks browser-based end-to-end tests requiring Playwright (run explicitly with '-m e2e')",
]

[tool.coverage.run]
branch = true         # measure branch coverage, not just lines
source = ["hassette"] # your packages/modules
parallel = true       # enable combining across workers/CI shards
relative_files = true # stable paths in CI
# Measure subprocesses (pytest-cov will set env automatically; this is belt+suspenders):
concurrency = ["thread", "multiprocessing"]
omit = ["*/__init__.py", "*/__main__.py"]

[tool.coverage.report]
show_missing = true
skip_covered = true
# fail_under = 85 # local default; CI can override
exclude_lines = [
    "pragma: no cover",
    "if TYPE_CHECKING:",
    "if __name__ == .__main__.:",
    "raise NotImplementedError",
]

[tool.djlint]
profile = "jinja"
indent = 2
max_line_length = 120
ignore = "H006,H030,H031,T002"

[tool.coverage.html]
directory = "htmlcov"

[tool.coverage.xml]
output = "coverage.xml"
